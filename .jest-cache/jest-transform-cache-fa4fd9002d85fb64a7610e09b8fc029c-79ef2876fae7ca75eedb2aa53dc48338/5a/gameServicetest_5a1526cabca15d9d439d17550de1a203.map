{"version":3,"names":["path","require","process","chdir","resolve","__dirname","gameService","describe","it","catalog","getGameCatalog","expected","forEach","id","filePath","entry","find","game","expect","toBeDefined","sourceFile","toBe","blackjackEntry","heist","getGameDetails","blocked","canUserLaunchGame","arcadeCredits","totalWins","purchasedComics","allowed","Array","isArray","reasons","afterEach","listSessions","session","endSession","sessionId","startSession","ownerId","initializeArgs","autoStart","name","initializeResult","success","state","players","toHaveLength","hitResult","executeAction","startingEnergy","grid","move","result","toEqual","position","any","Object","clawPosition","slotIds","gameId","index","spin","credits","toBeGreaterThanOrEqual","startingBank","winningNetWorth","money","available","properties","property","purchase","updatedProperty","next","turn","tradeTarget","trade","traded"],"sources":["gameService.test.js"],"sourcesContent":["/* eslint-env jest */\n'use strict';\n\nconst path = require('path');\n\n// Ensure NODE_PATH style resolution mirrors production root for dynamic requires\nprocess.chdir(path.resolve(__dirname, '..'));\n\nconst gameService = require('../diamondz-playhouse/backend/services/gameService');\n\ndescribe('game catalog wiring', () => {\n  it('exposes the new quick game stubs with updated source files', () => {\n    const catalog = gameService.getGameCatalog();\n    const expected = [\n      ['pimpire-claw', 'SourceCode/QuickGames/PimpireClaw.js'],\n      ['diamondz-slot', 'SourceCode/QuickGames/DiamondzSlot.js'],\n      ['dapaul-smooth-slot', 'SourceCode/QuickGames/DapaulSmoothSlot.js'],\n      ['golden-cane-slots', 'SourceCode/QuickGames/GoldenCaneSlots.js'],\n      ['mink-slot', 'SourceCode/QuickGames/MinkSlot.js'],\n      ['diamonds-high-roller-heist-slot', 'SourceCode/QuickGames/DiamondsHighRollerHeistSlot.js']\n    ];\n\n    expected.forEach(([id, filePath]) => {\n      const entry = catalog.find((game) => game.id === id);\n      expect(entry).toBeDefined();\n      expect(entry.sourceFile).toBe(filePath);\n    });\n\n    const blackjackEntry = catalog.find((entry) => entry.id === 'blackjack');\n    expect(blackjackEntry).toBeDefined();\n    expect(blackjackEntry.sourceFile).toBe('SourceCode/CardGames/Blackjack.js');\n  });\n\n  it('validates access rules against user profile', () => {\n    const heist = gameService.getGameDetails('diamond-heist-coin-dozer');\n    expect(heist).toBeDefined();\n\n    const blocked = gameService.canUserLaunchGame(heist, {\n      arcadeCredits: 100,\n      totalWins: 0,\n      purchasedComics: []\n    });\n    expect(blocked.allowed).toBe(false);\n    expect(Array.isArray(blocked.reasons)).toBe(true);\n  });\n});\n\ndescribe('game session lifecycle', () => {\n  afterEach(() => {\n    // Clean up any stray sessions between tests\n    gameService.listSessions().forEach((session) => {\n      gameService.endSession(session.sessionId);\n    });\n  });\n\n  it('creates a blackjack session without auto-starting the round', () => {\n    const session = gameService.startSession('blackjack', {\n      ownerId: 'tester-1',\n      initializeArgs: [2],\n      autoStart: false\n    });\n\n    expect(session).toBeDefined();\n    expect(session.name).toBe('Blackjack');\n    expect(session.initializeResult.success).toBe(true);\n    expect(session.state).toBeDefined();\n    expect(Array.isArray(session.state.players)).toBe(true);\n    expect(session.state.players).toHaveLength(2);\n\n    const hitResult = gameService.executeAction(session.sessionId, 'hit', [0], 'tester-1');\n    expect(hitResult).toBeDefined();\n    expect(hitResult.state).toBeDefined();\n  });\n\n  it('supports claw machine sessions with manual movement', () => {\n    const session = gameService.startSession('pimpire-claw', {\n      ownerId: 'tester-2',\n      initializeArgs: [{ autoStart: false, startingEnergy: 3 }],\n      autoStart: false\n    });\n\n    expect(session).toBeDefined();\n    expect(session.name).toBe('Pimpire Claw');\n    expect(session.initializeResult.grid).toBeDefined();\n\n    const move = gameService.executeAction(session.sessionId, 'moveClaw', ['left'], 'tester-2');\n    expect(move.result).toEqual({ success: true, position: expect.any(Object) });\n    expect(move.state).toBeDefined();\n    const position = move.state.clawPosition || move.state.position;\n    expect(position).toBeDefined();\n\n    // Dispose timers if test introduced any\n    gameService.executeAction(session.sessionId, 'dispose', [], 'tester-2');\n  });\n\n  it('spins quick slot sessions through the service actions', () => {\n    const slotIds = [\n      'diamondz-slot',\n      'dapaul-smooth-slot',\n      'golden-cane-slots',\n      'mink-slot',\n      'diamonds-high-roller-heist-slot'\n    ];\n\n    slotIds.forEach((gameId, index) => {\n      const ownerId = `slot-owner-${index}`;\n      const session = gameService.startSession(gameId, {\n        ownerId,\n        autoStart: true\n      });\n\n      expect(session).toBeDefined();\n      const spin = gameService.executeAction(session.sessionId, 'spin', [], ownerId);\n      expect(spin.result).toBeDefined();\n      expect(spin.result.success).toBe(true);\n      expect(spin.state).toBeDefined();\n      expect(typeof spin.state.credits).toBe('number');\n      expect(spin.state.credits).toBeGreaterThanOrEqual(0);\n\n      gameService.endSession(session.sessionId);\n    });\n  });\n\n  it('runs property manager turns with purchases and trades', () => {\n    const session = gameService.startSession('pempire-property-manager', {\n      ownerId: 'manager-1',\n      initializeArgs: [{\n        startingBank: 2000,\n        winningNetWorth: 1700,\n        players: [\n          { id: 'p1', name: 'Marquis', money: 800 },\n          { id: 'p2', name: 'Duchess', money: 750 }\n        ]\n      }],\n      autoStart: true\n    });\n\n    expect(session).toBeDefined();\n    expect(session.state.players).toHaveLength(2);\n    const available = session.state.properties.find((property) => !property.ownerId);\n    expect(available).toBeDefined();\n\n    const purchase = gameService.executeAction(\n      session.sessionId,\n      'buyProperty',\n      [available.id, 'p1'],\n      'manager-1'\n    );\n    expect(purchase.result.success).toBe(true);\n    const updatedProperty = purchase.state.properties.find((property) => property.id === available.id);\n    expect(updatedProperty.ownerId).toBe('p1');\n\n    const next = gameService.executeAction(session.sessionId, 'nextTurn', [], 'manager-1');\n    expect(next.result.success).toBe(true);\n    expect(next.state.turn).toBe(1);\n\n    const tradeTarget = purchase.state.properties.find((property) => property.ownerId === 'p1');\n    const trade = gameService.executeAction(\n      session.sessionId,\n      'tradeProperty',\n      [\n        'p1',\n        'p2',\n        tradeTarget.id,\n        100\n      ],\n      'manager-1'\n    );\n    expect(trade.result.success).toBe(true);\n    const traded = trade.state.properties.find((property) => property.id === tradeTarget.id);\n    expect(traded.ownerId).toBe('p2');\n\n    gameService.endSession(session.sessionId);\n  });\n});\n"],"mappings":"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","ignoreList":[]}