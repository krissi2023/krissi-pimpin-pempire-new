a9baac0dd16b892d5870a9cb750c464d
'use strict';

const path = require('path');
const {
  categories,
  games
} = require('../data/arcadeGames');
const ACTIVE_SESSIONS = new Map();
const PROJECT_ROOT = path.resolve(__dirname, '..', '..', '..');
const normalizeArgs = value => {
  if (Array.isArray(value)) {
    return value;
  }
  if (typeof value === 'undefined' || value === null) {
    return [];
  }
  return [value];
};
const formatCredits = value => {
  if (typeof value !== 'number' || Number.isNaN(value) || value <= 0) {
    return null;
  }
  return `$${(value / 100).toFixed(2)}`;
};
const collectUserComicIds = user => {
  if (!user || !Array.isArray(user.purchasedComics)) {
    return new Set();
  }
  return new Set(user.purchasedComics.map(entry => entry.comicId));
};
const captureState = instance => {
  if (!instance) {
    return null;
  }
  if (typeof instance.getGameState === 'function') {
    try {
      return instance.getGameState();
    } catch (err) {
      return {
        error: err.message
      };
    }
  }
  if (typeof instance.getState === 'function') {
    try {
      return instance.getState();
    } catch (err) {
      return {
        error: err.message
      };
    }
  }
  const snapshot = {};
  const simpleFields = ['score', 'playerScore', 'computerScore', 'gamesPlayed', 'remainingTime', 'isRunning', 'energy', 'streak', 'comboMultiplier'];
  simpleFields.forEach(field => {
    if (typeof instance[field] !== 'undefined') {
      snapshot[field] = instance[field];
    }
  });
  if (instance.clawPosition) {
    snapshot.clawPosition = instance.clawPosition;
  }
  if (Array.isArray(instance.players)) {
    snapshot.players = instance.players;
  }
  if (Array.isArray(instance.dealerHand)) {
    snapshot.dealerHand = instance.dealerHand;
  }
  if (Array.isArray(instance.prizeGrid)) {
    snapshot.prizeGrid = instance.prizeGrid;
  }
  if (Array.isArray(instance.firewalls)) {
    snapshot.firewalls = instance.firewalls;
  }
  return Object.keys(snapshot).length > 0 ? snapshot : null;
};
const toClientSession = (session, extra = {}) => ({
  sessionId: session.sessionId,
  gameId: session.gameId,
  name: session.name,
  type: session.type,
  ownerId: session.ownerId,
  createdAt: session.createdAt,
  lastInteraction: session.lastInteraction,
  metadata: session.metadata,
  state: captureState(session.instance),
  ...extra
});
const getCategoriesWithGames = () => categories.map(category => ({
  ...category,
  games: games.filter(game => game.category === category.key)
})).filter(category => category.games.length > 0);
const getGameCatalog = () => games.slice();
const getGameDetails = gameId => {
  const game = games.find(entry => entry.id === gameId);
  if (!game) {
    return null;
  }
  const category = categories.find(entry => entry.key === game.category) || null;
  return {
    ...game,
    categoryDetails: category,
    access: game.access || {}
  };
};
const loadGameClass = game => {
  if (!game.sourceFile) {
    throw new Error('Game source file is not defined');
  }
  const modulePath = path.join(PROJECT_ROOT, game.sourceFile);
  // eslint-disable-next-line global-require, import/no-dynamic-require
  const GameModule = require(modulePath);
  if (typeof GameModule !== 'function') {
    throw new Error(`Game module ${game.sourceFile} does not export a constructor`);
  }
  return GameModule;
};
const normalizeOwner = ownerId => {
  if (!ownerId) {
    throw new Error('Owner id is required for session management');
  }
  return ownerId.toString();
};
const ensureOwnership = (session, ownerId) => {
  if (!session) {
    return null;
  }
  const normalizedOwner = normalizeOwner(ownerId);
  return session.ownerId === normalizedOwner ? session : null;
};
const canUserLaunchGame = (game, user) => {
  if (!user) {
    return {
      allowed: false,
      reason: 'User information is required to validate access.'
    };
  }
  const access = game.access || {};
  const reasons = [];
  const creditsRequired = typeof access.minArcadeCredits === 'number' ? access.minArcadeCredits : null;
  const availableCredits = typeof user.arcadeCredits === 'number' ? user.arcadeCredits : 0;
  if (creditsRequired && availableCredits < creditsRequired) {
    const formatted = formatCredits(creditsRequired) || `${creditsRequired} credits`;
    reasons.push(`Requires at least ${formatted} in arcade credits.`);
  }
  if (access.requiresVip && !user.isVip) {
    reasons.push('VIP Lounge access is required for this cabinet.');
  }
  if (typeof access.minTotalWins === 'number' && user.totalWins < access.minTotalWins) {
    reasons.push(`Win ${access.minTotalWins} arcade matches to unlock this cabinet.`);
  }
  if (Array.isArray(access.requiredComicIds) && access.requiredComicIds.length > 0) {
    const ownedComicIds = collectUserComicIds(user);
    const missingComics = access.requiredComicIds.filter(comicId => !ownedComicIds.has(comicId));
    if (missingComics.length > 0) {
      const titles = Array.isArray(access.requiredComicTitles) && access.requiredComicTitles.length > 0 ? access.requiredComicTitles : missingComics;
      reasons.push(`Purchase ${titles.join(', ')} to unlock this cabinet.`);
    }
  }
  if (reasons.length > 0) {
    return {
      allowed: false,
      reason: reasons.join(' '),
      reasons
    };
  }
  return {
    allowed: true
  };
};
const startSession = (gameId, options = {}) => {
  const game = games.find(entry => entry.id === gameId);
  if (!game) {
    throw new Error('Game not found');
  }
  const ownerId = normalizeOwner(options.ownerId);
  const GameClass = loadGameClass(game);
  const instance = new GameClass();
  const sessionId = `sess_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;
  const session = {
    sessionId,
    instance,
    gameId: game.id,
    name: game.name,
    type: game.type,
    ownerId,
    metadata: {
      minPlayers: game.minPlayers || null,
      maxPlayers: game.maxPlayers || null,
      minBet: game.minBet || null,
      maxBet: game.maxBet || null,
      unlockRequirement: game.unlockRequirement || null,
      description: game.description || null,
      access: game.access || {}
    },
    createdAt: new Date(),
    lastInteraction: new Date()
  };
  const initializeArgs = normalizeArgs(options.initializeArgs);
  let initializeResult = null;
  if (typeof instance.initialize === 'function') {
    initializeResult = instance.initialize(...initializeArgs);
  }
  let startResult = null;
  if (options.autoStart !== false) {
    const startArgs = normalizeArgs(options.startArgs);
    if (typeof instance.start === 'function') {
      startResult = instance.start(...startArgs);
    } else if (typeof instance.startGame === 'function') {
      startResult = instance.startGame(...startArgs);
    }
  }
  ACTIVE_SESSIONS.set(sessionId, session);
  return toClientSession(session, {
    initializeResult,
    startResult
  });
};
const getSession = sessionId => {
  const session = ACTIVE_SESSIONS.get(sessionId);
  if (!session) {
    return null;
  }
  return toClientSession(session);
};
const getSessionForOwner = (sessionId, ownerId) => {
  const session = ensureOwnership(ACTIVE_SESSIONS.get(sessionId), ownerId);
  if (!session) {
    return null;
  }
  return toClientSession(session);
};
const executeAction = (sessionId, action, args = [], ownerId) => {
  const session = ensureOwnership(ACTIVE_SESSIONS.get(sessionId), ownerId);
  if (!session) {
    throw new Error('Session not found');
  }
  if (!action || typeof action !== 'string') {
    throw new Error('Action name is required');
  }
  const target = session.instance[action];
  if (typeof target !== 'function') {
    throw new Error(`Action ${action} is not supported by this game`);
  }
  const result = target.apply(session.instance, normalizeArgs(args));
  session.lastInteraction = new Date();
  return {
    result,
    state: captureState(session.instance)
  };
};
const endSession = sessionId => {
  const session = ACTIVE_SESSIONS.get(sessionId);
  if (!session) {
    return null;
  }
  ACTIVE_SESSIONS.delete(sessionId);
  return {
    sessionId,
    endedAt: new Date()
  };
};
const endSessionForOwner = (sessionId, ownerId) => {
  const session = ensureOwnership(ACTIVE_SESSIONS.get(sessionId), ownerId);
  if (!session) {
    return null;
  }
  ACTIVE_SESSIONS.delete(sessionId);
  return {
    sessionId,
    endedAt: new Date()
  };
};
const listSessions = (ownerId = null) => {
  const entries = Array.from(ACTIVE_SESSIONS.values());
  const filtered = ownerId ? entries.filter(session => session.ownerId === normalizeOwner(ownerId)) : entries;
  return filtered.map(session => toClientSession(session));
};
module.exports = {
  getCategoriesWithGames,
  getGameCatalog,
  getGameDetails,
  startSession,
  getSession,
  getSessionForOwner,
  executeAction,
  endSession,
  endSessionForOwner,
  listSessions,
  canUserLaunchGame
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsImNhdGVnb3JpZXMiLCJnYW1lcyIsIkFDVElWRV9TRVNTSU9OUyIsIk1hcCIsIlBST0pFQ1RfUk9PVCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJub3JtYWxpemVBcmdzIiwidmFsdWUiLCJBcnJheSIsImlzQXJyYXkiLCJmb3JtYXRDcmVkaXRzIiwiTnVtYmVyIiwiaXNOYU4iLCJ0b0ZpeGVkIiwiY29sbGVjdFVzZXJDb21pY0lkcyIsInVzZXIiLCJwdXJjaGFzZWRDb21pY3MiLCJTZXQiLCJtYXAiLCJlbnRyeSIsImNvbWljSWQiLCJjYXB0dXJlU3RhdGUiLCJpbnN0YW5jZSIsImdldEdhbWVTdGF0ZSIsImVyciIsImVycm9yIiwibWVzc2FnZSIsImdldFN0YXRlIiwic25hcHNob3QiLCJzaW1wbGVGaWVsZHMiLCJmb3JFYWNoIiwiZmllbGQiLCJjbGF3UG9zaXRpb24iLCJwbGF5ZXJzIiwiZGVhbGVySGFuZCIsInByaXplR3JpZCIsImZpcmV3YWxscyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJ0b0NsaWVudFNlc3Npb24iLCJzZXNzaW9uIiwiZXh0cmEiLCJzZXNzaW9uSWQiLCJnYW1lSWQiLCJuYW1lIiwidHlwZSIsIm93bmVySWQiLCJjcmVhdGVkQXQiLCJsYXN0SW50ZXJhY3Rpb24iLCJtZXRhZGF0YSIsInN0YXRlIiwiZ2V0Q2F0ZWdvcmllc1dpdGhHYW1lcyIsImNhdGVnb3J5IiwiZmlsdGVyIiwiZ2FtZSIsImtleSIsImdldEdhbWVDYXRhbG9nIiwic2xpY2UiLCJnZXRHYW1lRGV0YWlscyIsImZpbmQiLCJpZCIsImNhdGVnb3J5RGV0YWlscyIsImFjY2VzcyIsImxvYWRHYW1lQ2xhc3MiLCJzb3VyY2VGaWxlIiwiRXJyb3IiLCJtb2R1bGVQYXRoIiwiam9pbiIsIkdhbWVNb2R1bGUiLCJub3JtYWxpemVPd25lciIsInRvU3RyaW5nIiwiZW5zdXJlT3duZXJzaGlwIiwibm9ybWFsaXplZE93bmVyIiwiY2FuVXNlckxhdW5jaEdhbWUiLCJhbGxvd2VkIiwicmVhc29uIiwicmVhc29ucyIsImNyZWRpdHNSZXF1aXJlZCIsIm1pbkFyY2FkZUNyZWRpdHMiLCJhdmFpbGFibGVDcmVkaXRzIiwiYXJjYWRlQ3JlZGl0cyIsImZvcm1hdHRlZCIsInB1c2giLCJyZXF1aXJlc1ZpcCIsImlzVmlwIiwibWluVG90YWxXaW5zIiwidG90YWxXaW5zIiwicmVxdWlyZWRDb21pY0lkcyIsIm93bmVkQ29taWNJZHMiLCJtaXNzaW5nQ29taWNzIiwiaGFzIiwidGl0bGVzIiwicmVxdWlyZWRDb21pY1RpdGxlcyIsInN0YXJ0U2Vzc2lvbiIsIm9wdGlvbnMiLCJHYW1lQ2xhc3MiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsIm1pblBsYXllcnMiLCJtYXhQbGF5ZXJzIiwibWluQmV0IiwibWF4QmV0IiwidW5sb2NrUmVxdWlyZW1lbnQiLCJkZXNjcmlwdGlvbiIsImluaXRpYWxpemVBcmdzIiwiaW5pdGlhbGl6ZVJlc3VsdCIsImluaXRpYWxpemUiLCJzdGFydFJlc3VsdCIsImF1dG9TdGFydCIsInN0YXJ0QXJncyIsInN0YXJ0Iiwic3RhcnRHYW1lIiwic2V0IiwiZ2V0U2Vzc2lvbiIsImdldCIsImdldFNlc3Npb25Gb3JPd25lciIsImV4ZWN1dGVBY3Rpb24iLCJhY3Rpb24iLCJhcmdzIiwidGFyZ2V0IiwicmVzdWx0IiwiYXBwbHkiLCJlbmRTZXNzaW9uIiwiZGVsZXRlIiwiZW5kZWRBdCIsImVuZFNlc3Npb25Gb3JPd25lciIsImxpc3RTZXNzaW9ucyIsImVudHJpZXMiLCJmcm9tIiwidmFsdWVzIiwiZmlsdGVyZWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiZ2FtZVNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBjYXRlZ29yaWVzLCBnYW1lcyB9ID0gcmVxdWlyZSgnLi4vZGF0YS9hcmNhZGVHYW1lcycpO1xuXG5jb25zdCBBQ1RJVkVfU0VTU0lPTlMgPSBuZXcgTWFwKCk7XG5jb25zdCBQUk9KRUNUX1JPT1QgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nKTtcblxuY29uc3Qgbm9ybWFsaXplQXJncyA9ICh2YWx1ZSkgPT4ge1xuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIFt2YWx1ZV07XG59O1xuXG5jb25zdCBmb3JtYXRDcmVkaXRzID0gKHZhbHVlKSA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInIHx8IE51bWJlci5pc05hTih2YWx1ZSkgfHwgdmFsdWUgPD0gMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHJldHVybiBgJCR7KHZhbHVlIC8gMTAwKS50b0ZpeGVkKDIpfWA7XG59O1xuXG5jb25zdCBjb2xsZWN0VXNlckNvbWljSWRzID0gKHVzZXIpID0+IHtcbiAgaWYgKCF1c2VyIHx8ICFBcnJheS5pc0FycmF5KHVzZXIucHVyY2hhc2VkQ29taWNzKSkge1xuICAgIHJldHVybiBuZXcgU2V0KCk7XG4gIH1cbiAgcmV0dXJuIG5ldyBTZXQodXNlci5wdXJjaGFzZWRDb21pY3MubWFwKChlbnRyeSkgPT4gZW50cnkuY29taWNJZCkpO1xufTtcblxuY29uc3QgY2FwdHVyZVN0YXRlID0gKGluc3RhbmNlKSA9PiB7XG4gIGlmICghaW5zdGFuY2UpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmICh0eXBlb2YgaW5zdGFuY2UuZ2V0R2FtZVN0YXRlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBpbnN0YW5jZS5nZXRHYW1lU3RhdGUoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB7IGVycm9yOiBlcnIubWVzc2FnZSB9O1xuICAgIH1cbiAgfVxuXG4gIGlmICh0eXBlb2YgaW5zdGFuY2UuZ2V0U3RhdGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGluc3RhbmNlLmdldFN0YXRlKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZXR1cm4geyBlcnJvcjogZXJyLm1lc3NhZ2UgfTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBzbmFwc2hvdCA9IHt9O1xuICBjb25zdCBzaW1wbGVGaWVsZHMgPSBbXG4gICAgJ3Njb3JlJyxcbiAgICAncGxheWVyU2NvcmUnLFxuICAgICdjb21wdXRlclNjb3JlJyxcbiAgICAnZ2FtZXNQbGF5ZWQnLFxuICAgICdyZW1haW5pbmdUaW1lJyxcbiAgICAnaXNSdW5uaW5nJyxcbiAgICAnZW5lcmd5JyxcbiAgICAnc3RyZWFrJyxcbiAgICAnY29tYm9NdWx0aXBsaWVyJ1xuICBdO1xuXG4gIHNpbXBsZUZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgIGlmICh0eXBlb2YgaW5zdGFuY2VbZmllbGRdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgc25hcHNob3RbZmllbGRdID0gaW5zdGFuY2VbZmllbGRdO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGluc3RhbmNlLmNsYXdQb3NpdGlvbikge1xuICAgIHNuYXBzaG90LmNsYXdQb3NpdGlvbiA9IGluc3RhbmNlLmNsYXdQb3NpdGlvbjtcbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KGluc3RhbmNlLnBsYXllcnMpKSB7XG4gICAgc25hcHNob3QucGxheWVycyA9IGluc3RhbmNlLnBsYXllcnM7XG4gIH1cblxuICBpZiAoQXJyYXkuaXNBcnJheShpbnN0YW5jZS5kZWFsZXJIYW5kKSkge1xuICAgIHNuYXBzaG90LmRlYWxlckhhbmQgPSBpbnN0YW5jZS5kZWFsZXJIYW5kO1xuICB9XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkoaW5zdGFuY2UucHJpemVHcmlkKSkge1xuICAgIHNuYXBzaG90LnByaXplR3JpZCA9IGluc3RhbmNlLnByaXplR3JpZDtcbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KGluc3RhbmNlLmZpcmV3YWxscykpIHtcbiAgICBzbmFwc2hvdC5maXJld2FsbHMgPSBpbnN0YW5jZS5maXJld2FsbHM7XG4gIH1cblxuICByZXR1cm4gT2JqZWN0LmtleXMoc25hcHNob3QpLmxlbmd0aCA+IDAgPyBzbmFwc2hvdCA6IG51bGw7XG59O1xuXG5jb25zdCB0b0NsaWVudFNlc3Npb24gPSAoc2Vzc2lvbiwgZXh0cmEgPSB7fSkgPT4gKHtcbiAgc2Vzc2lvbklkOiBzZXNzaW9uLnNlc3Npb25JZCxcbiAgZ2FtZUlkOiBzZXNzaW9uLmdhbWVJZCxcbiAgbmFtZTogc2Vzc2lvbi5uYW1lLFxuICB0eXBlOiBzZXNzaW9uLnR5cGUsXG4gIG93bmVySWQ6IHNlc3Npb24ub3duZXJJZCxcbiAgY3JlYXRlZEF0OiBzZXNzaW9uLmNyZWF0ZWRBdCxcbiAgbGFzdEludGVyYWN0aW9uOiBzZXNzaW9uLmxhc3RJbnRlcmFjdGlvbixcbiAgbWV0YWRhdGE6IHNlc3Npb24ubWV0YWRhdGEsXG4gIHN0YXRlOiBjYXB0dXJlU3RhdGUoc2Vzc2lvbi5pbnN0YW5jZSksXG4gIC4uLmV4dHJhXG59KTtcblxuY29uc3QgZ2V0Q2F0ZWdvcmllc1dpdGhHYW1lcyA9ICgpID0+XG4gIGNhdGVnb3JpZXNcbiAgICAubWFwKChjYXRlZ29yeSkgPT4gKHtcbiAgICAgIC4uLmNhdGVnb3J5LFxuICAgICAgZ2FtZXM6IGdhbWVzLmZpbHRlcigoZ2FtZSkgPT4gZ2FtZS5jYXRlZ29yeSA9PT0gY2F0ZWdvcnkua2V5KVxuICAgIH0pKVxuICAgIC5maWx0ZXIoKGNhdGVnb3J5KSA9PiBjYXRlZ29yeS5nYW1lcy5sZW5ndGggPiAwKTtcblxuY29uc3QgZ2V0R2FtZUNhdGFsb2cgPSAoKSA9PiBnYW1lcy5zbGljZSgpO1xuXG5jb25zdCBnZXRHYW1lRGV0YWlscyA9IChnYW1lSWQpID0+IHtcbiAgY29uc3QgZ2FtZSA9IGdhbWVzLmZpbmQoKGVudHJ5KSA9PiBlbnRyeS5pZCA9PT0gZ2FtZUlkKTtcbiAgaWYgKCFnYW1lKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgY2F0ZWdvcnkgPSBjYXRlZ29yaWVzLmZpbmQoKGVudHJ5KSA9PiBlbnRyeS5rZXkgPT09IGdhbWUuY2F0ZWdvcnkpIHx8IG51bGw7XG4gIHJldHVybiB7XG4gICAgLi4uZ2FtZSxcbiAgICBjYXRlZ29yeURldGFpbHM6IGNhdGVnb3J5LFxuICAgIGFjY2VzczogZ2FtZS5hY2Nlc3MgfHwge31cbiAgfTtcbn07XG5cbmNvbnN0IGxvYWRHYW1lQ2xhc3MgPSAoZ2FtZSkgPT4ge1xuICBpZiAoIWdhbWUuc291cmNlRmlsZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignR2FtZSBzb3VyY2UgZmlsZSBpcyBub3QgZGVmaW5lZCcpO1xuICB9XG4gIGNvbnN0IG1vZHVsZVBhdGggPSBwYXRoLmpvaW4oUFJPSkVDVF9ST09ULCBnYW1lLnNvdXJjZUZpbGUpO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ2xvYmFsLXJlcXVpcmUsIGltcG9ydC9uby1keW5hbWljLXJlcXVpcmVcbiAgY29uc3QgR2FtZU1vZHVsZSA9IHJlcXVpcmUobW9kdWxlUGF0aCk7XG4gIGlmICh0eXBlb2YgR2FtZU1vZHVsZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcihgR2FtZSBtb2R1bGUgJHtnYW1lLnNvdXJjZUZpbGV9IGRvZXMgbm90IGV4cG9ydCBhIGNvbnN0cnVjdG9yYCk7XG4gIH1cbiAgcmV0dXJuIEdhbWVNb2R1bGU7XG59O1xuXG5jb25zdCBub3JtYWxpemVPd25lciA9IChvd25lcklkKSA9PiB7XG4gIGlmICghb3duZXJJZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignT3duZXIgaWQgaXMgcmVxdWlyZWQgZm9yIHNlc3Npb24gbWFuYWdlbWVudCcpO1xuICB9XG4gIHJldHVybiBvd25lcklkLnRvU3RyaW5nKCk7XG59O1xuXG5jb25zdCBlbnN1cmVPd25lcnNoaXAgPSAoc2Vzc2lvbiwgb3duZXJJZCkgPT4ge1xuICBpZiAoIXNlc3Npb24pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBub3JtYWxpemVkT3duZXIgPSBub3JtYWxpemVPd25lcihvd25lcklkKTtcbiAgcmV0dXJuIHNlc3Npb24ub3duZXJJZCA9PT0gbm9ybWFsaXplZE93bmVyID8gc2Vzc2lvbiA6IG51bGw7XG59O1xuXG5jb25zdCBjYW5Vc2VyTGF1bmNoR2FtZSA9IChnYW1lLCB1c2VyKSA9PiB7XG4gIGlmICghdXNlcikge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ1VzZXIgaW5mb3JtYXRpb24gaXMgcmVxdWlyZWQgdG8gdmFsaWRhdGUgYWNjZXNzLidcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgYWNjZXNzID0gZ2FtZS5hY2Nlc3MgfHwge307XG4gIGNvbnN0IHJlYXNvbnMgPSBbXTtcblxuICBjb25zdCBjcmVkaXRzUmVxdWlyZWQgPSB0eXBlb2YgYWNjZXNzLm1pbkFyY2FkZUNyZWRpdHMgPT09ICdudW1iZXInID8gYWNjZXNzLm1pbkFyY2FkZUNyZWRpdHMgOiBudWxsO1xuICBjb25zdCBhdmFpbGFibGVDcmVkaXRzID0gdHlwZW9mIHVzZXIuYXJjYWRlQ3JlZGl0cyA9PT0gJ251bWJlcicgPyB1c2VyLmFyY2FkZUNyZWRpdHMgOiAwO1xuICBpZiAoY3JlZGl0c1JlcXVpcmVkICYmIGF2YWlsYWJsZUNyZWRpdHMgPCBjcmVkaXRzUmVxdWlyZWQpIHtcbiAgICBjb25zdCBmb3JtYXR0ZWQgPSBmb3JtYXRDcmVkaXRzKGNyZWRpdHNSZXF1aXJlZCkgfHwgYCR7Y3JlZGl0c1JlcXVpcmVkfSBjcmVkaXRzYDtcbiAgICByZWFzb25zLnB1c2goYFJlcXVpcmVzIGF0IGxlYXN0ICR7Zm9ybWF0dGVkfSBpbiBhcmNhZGUgY3JlZGl0cy5gKTtcbiAgfVxuXG4gIGlmIChhY2Nlc3MucmVxdWlyZXNWaXAgJiYgIXVzZXIuaXNWaXApIHtcbiAgICByZWFzb25zLnB1c2goJ1ZJUCBMb3VuZ2UgYWNjZXNzIGlzIHJlcXVpcmVkIGZvciB0aGlzIGNhYmluZXQuJyk7XG4gIH1cblxuICBpZiAodHlwZW9mIGFjY2Vzcy5taW5Ub3RhbFdpbnMgPT09ICdudW1iZXInICYmIHVzZXIudG90YWxXaW5zIDwgYWNjZXNzLm1pblRvdGFsV2lucykge1xuICAgIHJlYXNvbnMucHVzaChgV2luICR7YWNjZXNzLm1pblRvdGFsV2luc30gYXJjYWRlIG1hdGNoZXMgdG8gdW5sb2NrIHRoaXMgY2FiaW5ldC5gKTtcbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KGFjY2Vzcy5yZXF1aXJlZENvbWljSWRzKSAmJiBhY2Nlc3MucmVxdWlyZWRDb21pY0lkcy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3Qgb3duZWRDb21pY0lkcyA9IGNvbGxlY3RVc2VyQ29taWNJZHModXNlcik7XG4gICAgY29uc3QgbWlzc2luZ0NvbWljcyA9IGFjY2Vzcy5yZXF1aXJlZENvbWljSWRzLmZpbHRlcigoY29taWNJZCkgPT4gIW93bmVkQ29taWNJZHMuaGFzKGNvbWljSWQpKTtcbiAgICBpZiAobWlzc2luZ0NvbWljcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCB0aXRsZXMgPSBBcnJheS5pc0FycmF5KGFjY2Vzcy5yZXF1aXJlZENvbWljVGl0bGVzKSAmJiBhY2Nlc3MucmVxdWlyZWRDb21pY1RpdGxlcy5sZW5ndGggPiAwXG4gICAgICAgID8gYWNjZXNzLnJlcXVpcmVkQ29taWNUaXRsZXNcbiAgICAgICAgOiBtaXNzaW5nQ29taWNzO1xuICAgICAgcmVhc29ucy5wdXNoKGBQdXJjaGFzZSAke3RpdGxlcy5qb2luKCcsICcpfSB0byB1bmxvY2sgdGhpcyBjYWJpbmV0LmApO1xuICAgIH1cbiAgfVxuXG4gIGlmIChyZWFzb25zLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb246IHJlYXNvbnMuam9pbignICcpLFxuICAgICAgcmVhc29uc1xuICAgIH07XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWVcbiAgfTtcbn07XG5cbmNvbnN0IHN0YXJ0U2Vzc2lvbiA9IChnYW1lSWQsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCBnYW1lID0gZ2FtZXMuZmluZCgoZW50cnkpID0+IGVudHJ5LmlkID09PSBnYW1lSWQpO1xuICBpZiAoIWdhbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0dhbWUgbm90IGZvdW5kJyk7XG4gIH1cblxuICBjb25zdCBvd25lcklkID0gbm9ybWFsaXplT3duZXIob3B0aW9ucy5vd25lcklkKTtcblxuICBjb25zdCBHYW1lQ2xhc3MgPSBsb2FkR2FtZUNsYXNzKGdhbWUpO1xuICBjb25zdCBpbnN0YW5jZSA9IG5ldyBHYW1lQ2xhc3MoKTtcbiAgY29uc3Qgc2Vzc2lvbklkID0gYHNlc3NfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWA7XG5cbiAgY29uc3Qgc2Vzc2lvbiA9IHtcbiAgICBzZXNzaW9uSWQsXG4gICAgaW5zdGFuY2UsXG4gICAgZ2FtZUlkOiBnYW1lLmlkLFxuICAgIG5hbWU6IGdhbWUubmFtZSxcbiAgICB0eXBlOiBnYW1lLnR5cGUsXG4gICAgb3duZXJJZCxcbiAgICBtZXRhZGF0YToge1xuICAgICAgbWluUGxheWVyczogZ2FtZS5taW5QbGF5ZXJzIHx8IG51bGwsXG4gICAgICBtYXhQbGF5ZXJzOiBnYW1lLm1heFBsYXllcnMgfHwgbnVsbCxcbiAgICAgIG1pbkJldDogZ2FtZS5taW5CZXQgfHwgbnVsbCxcbiAgICAgIG1heEJldDogZ2FtZS5tYXhCZXQgfHwgbnVsbCxcbiAgICAgIHVubG9ja1JlcXVpcmVtZW50OiBnYW1lLnVubG9ja1JlcXVpcmVtZW50IHx8IG51bGwsXG4gICAgICBkZXNjcmlwdGlvbjogZ2FtZS5kZXNjcmlwdGlvbiB8fCBudWxsLFxuICAgICAgYWNjZXNzOiBnYW1lLmFjY2VzcyB8fCB7fVxuICAgIH0sXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIGxhc3RJbnRlcmFjdGlvbjogbmV3IERhdGUoKVxuICB9O1xuXG4gIGNvbnN0IGluaXRpYWxpemVBcmdzID0gbm9ybWFsaXplQXJncyhvcHRpb25zLmluaXRpYWxpemVBcmdzKTtcbiAgbGV0IGluaXRpYWxpemVSZXN1bHQgPSBudWxsO1xuICBpZiAodHlwZW9mIGluc3RhbmNlLmluaXRpYWxpemUgPT09ICdmdW5jdGlvbicpIHtcbiAgICBpbml0aWFsaXplUmVzdWx0ID0gaW5zdGFuY2UuaW5pdGlhbGl6ZSguLi5pbml0aWFsaXplQXJncyk7XG4gIH1cblxuICBsZXQgc3RhcnRSZXN1bHQgPSBudWxsO1xuICBpZiAob3B0aW9ucy5hdXRvU3RhcnQgIT09IGZhbHNlKSB7XG4gICAgY29uc3Qgc3RhcnRBcmdzID0gbm9ybWFsaXplQXJncyhvcHRpb25zLnN0YXJ0QXJncyk7XG4gICAgaWYgKHR5cGVvZiBpbnN0YW5jZS5zdGFydCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgc3RhcnRSZXN1bHQgPSBpbnN0YW5jZS5zdGFydCguLi5zdGFydEFyZ3MpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGluc3RhbmNlLnN0YXJ0R2FtZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgc3RhcnRSZXN1bHQgPSBpbnN0YW5jZS5zdGFydEdhbWUoLi4uc3RhcnRBcmdzKTtcbiAgICB9XG4gIH1cblxuICBBQ1RJVkVfU0VTU0lPTlMuc2V0KHNlc3Npb25JZCwgc2Vzc2lvbik7XG5cbiAgcmV0dXJuIHRvQ2xpZW50U2Vzc2lvbihzZXNzaW9uLCB7XG4gICAgaW5pdGlhbGl6ZVJlc3VsdCxcbiAgICBzdGFydFJlc3VsdFxuICB9KTtcbn07XG5cbmNvbnN0IGdldFNlc3Npb24gPSAoc2Vzc2lvbklkKSA9PiB7XG4gIGNvbnN0IHNlc3Npb24gPSBBQ1RJVkVfU0VTU0lPTlMuZ2V0KHNlc3Npb25JZCk7XG4gIGlmICghc2Vzc2lvbikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHJldHVybiB0b0NsaWVudFNlc3Npb24oc2Vzc2lvbik7XG59O1xuXG5jb25zdCBnZXRTZXNzaW9uRm9yT3duZXIgPSAoc2Vzc2lvbklkLCBvd25lcklkKSA9PiB7XG4gIGNvbnN0IHNlc3Npb24gPSBlbnN1cmVPd25lcnNoaXAoQUNUSVZFX1NFU1NJT05TLmdldChzZXNzaW9uSWQpLCBvd25lcklkKTtcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIHRvQ2xpZW50U2Vzc2lvbihzZXNzaW9uKTtcbn07XG5cbmNvbnN0IGV4ZWN1dGVBY3Rpb24gPSAoc2Vzc2lvbklkLCBhY3Rpb24sIGFyZ3MgPSBbXSwgb3duZXJJZCkgPT4ge1xuICBjb25zdCBzZXNzaW9uID0gZW5zdXJlT3duZXJzaGlwKEFDVElWRV9TRVNTSU9OUy5nZXQoc2Vzc2lvbklkKSwgb3duZXJJZCk7XG4gIGlmICghc2Vzc2lvbikge1xuICAgIHRocm93IG5ldyBFcnJvcignU2Vzc2lvbiBub3QgZm91bmQnKTtcbiAgfVxuICBpZiAoIWFjdGlvbiB8fCB0eXBlb2YgYWN0aW9uICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBFcnJvcignQWN0aW9uIG5hbWUgaXMgcmVxdWlyZWQnKTtcbiAgfVxuICBjb25zdCB0YXJnZXQgPSBzZXNzaW9uLmluc3RhbmNlW2FjdGlvbl07XG4gIGlmICh0eXBlb2YgdGFyZ2V0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBBY3Rpb24gJHthY3Rpb259IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBnYW1lYCk7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gdGFyZ2V0LmFwcGx5KHNlc3Npb24uaW5zdGFuY2UsIG5vcm1hbGl6ZUFyZ3MoYXJncykpO1xuICBzZXNzaW9uLmxhc3RJbnRlcmFjdGlvbiA9IG5ldyBEYXRlKCk7XG4gIHJldHVybiB7XG4gICAgcmVzdWx0LFxuICAgIHN0YXRlOiBjYXB0dXJlU3RhdGUoc2Vzc2lvbi5pbnN0YW5jZSlcbiAgfTtcbn07XG5cbmNvbnN0IGVuZFNlc3Npb24gPSAoc2Vzc2lvbklkKSA9PiB7XG4gIGNvbnN0IHNlc3Npb24gPSBBQ1RJVkVfU0VTU0lPTlMuZ2V0KHNlc3Npb25JZCk7XG4gIGlmICghc2Vzc2lvbikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIEFDVElWRV9TRVNTSU9OUy5kZWxldGUoc2Vzc2lvbklkKTtcbiAgcmV0dXJuIHtcbiAgICBzZXNzaW9uSWQsXG4gICAgZW5kZWRBdDogbmV3IERhdGUoKVxuICB9O1xufTtcblxuY29uc3QgZW5kU2Vzc2lvbkZvck93bmVyID0gKHNlc3Npb25JZCwgb3duZXJJZCkgPT4ge1xuICBjb25zdCBzZXNzaW9uID0gZW5zdXJlT3duZXJzaGlwKEFDVElWRV9TRVNTSU9OUy5nZXQoc2Vzc2lvbklkKSwgb3duZXJJZCk7XG4gIGlmICghc2Vzc2lvbikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIEFDVElWRV9TRVNTSU9OUy5kZWxldGUoc2Vzc2lvbklkKTtcbiAgcmV0dXJuIHtcbiAgICBzZXNzaW9uSWQsXG4gICAgZW5kZWRBdDogbmV3IERhdGUoKVxuICB9O1xufTtcblxuY29uc3QgbGlzdFNlc3Npb25zID0gKG93bmVySWQgPSBudWxsKSA9PiB7XG4gIGNvbnN0IGVudHJpZXMgPSBBcnJheS5mcm9tKEFDVElWRV9TRVNTSU9OUy52YWx1ZXMoKSk7XG4gIGNvbnN0IGZpbHRlcmVkID0gb3duZXJJZCA/IGVudHJpZXMuZmlsdGVyKChzZXNzaW9uKSA9PiBzZXNzaW9uLm93bmVySWQgPT09IG5vcm1hbGl6ZU93bmVyKG93bmVySWQpKSA6IGVudHJpZXM7XG4gIHJldHVybiBmaWx0ZXJlZC5tYXAoKHNlc3Npb24pID0+IHRvQ2xpZW50U2Vzc2lvbihzZXNzaW9uKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZ2V0Q2F0ZWdvcmllc1dpdGhHYW1lcyxcbiAgZ2V0R2FtZUNhdGFsb2csXG4gIGdldEdhbWVEZXRhaWxzLFxuICBzdGFydFNlc3Npb24sXG4gIGdldFNlc3Npb24sXG4gIGdldFNlc3Npb25Gb3JPd25lcixcbiAgZXhlY3V0ZUFjdGlvbixcbiAgZW5kU2Vzc2lvbixcbiAgZW5kU2Vzc2lvbkZvck93bmVyLFxuICBsaXN0U2Vzc2lvbnMsXG4gIGNhblVzZXJMYXVuY2hHYW1lXG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUM1QixNQUFNO0VBQUVDLFVBQVU7RUFBRUM7QUFBTSxDQUFDLEdBQUdGLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQztBQUU1RCxNQUFNRyxlQUFlLEdBQUcsSUFBSUMsR0FBRyxDQUFDLENBQUM7QUFDakMsTUFBTUMsWUFBWSxHQUFHTixJQUFJLENBQUNPLE9BQU8sQ0FBQ0MsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO0FBRTlELE1BQU1DLGFBQWEsR0FBSUMsS0FBSyxJQUFLO0VBQy9CLElBQUlDLEtBQUssQ0FBQ0MsT0FBTyxDQUFDRixLQUFLLENBQUMsRUFBRTtJQUN4QixPQUFPQSxLQUFLO0VBQ2Q7RUFDQSxJQUFJLE9BQU9BLEtBQUssS0FBSyxXQUFXLElBQUlBLEtBQUssS0FBSyxJQUFJLEVBQUU7SUFDbEQsT0FBTyxFQUFFO0VBQ1g7RUFDQSxPQUFPLENBQUNBLEtBQUssQ0FBQztBQUNoQixDQUFDO0FBRUQsTUFBTUcsYUFBYSxHQUFJSCxLQUFLLElBQUs7RUFDL0IsSUFBSSxPQUFPQSxLQUFLLEtBQUssUUFBUSxJQUFJSSxNQUFNLENBQUNDLEtBQUssQ0FBQ0wsS0FBSyxDQUFDLElBQUlBLEtBQUssSUFBSSxDQUFDLEVBQUU7SUFDbEUsT0FBTyxJQUFJO0VBQ2I7RUFDQSxPQUFPLElBQUksQ0FBQ0EsS0FBSyxHQUFH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