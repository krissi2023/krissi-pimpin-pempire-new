77f3f6888c6cb73a9d085a1dbcefef8e
/* eslint-env jest */
'use strict';

const path = require('path');

// Ensure NODE_PATH style resolution mirrors production root for dynamic requires
process.chdir(path.resolve(__dirname, '..'));
const gameService = require('../diamondz-playhouse/backend/services/gameService');
describe('game catalog wiring', () => {
  it('exposes the new quick game stubs with updated source files', () => {
    const catalog = gameService.getGameCatalog();
    const expected = [['pimpire-claw', 'SourceCode/QuickGames/PimpireClaw.js'], ['diamondz-slot', 'SourceCode/QuickGames/DiamondzSlot.js'], ['dapaul-smooth-slot', 'SourceCode/QuickGames/DapaulSmoothSlot.js'], ['golden-cane-slots', 'SourceCode/QuickGames/GoldenCaneSlots.js'], ['mink-slot', 'SourceCode/QuickGames/MinkSlot.js'], ['diamonds-high-roller-heist-slot', 'SourceCode/QuickGames/DiamondsHighRollerHeistSlot.js']];
    expected.forEach(([id, filePath]) => {
      const entry = catalog.find(game => game.id === id);
      expect(entry).toBeDefined();
      expect(entry.sourceFile).toBe(filePath);
    });
    const blackjackEntry = catalog.find(entry => entry.id === 'blackjack');
    expect(blackjackEntry).toBeDefined();
    expect(blackjackEntry.sourceFile).toBe('SourceCode/CardGames/Blackjack.js');
  });
  it('validates access rules against user profile', () => {
    const heist = gameService.getGameDetails('diamond-heist-coin-dozer');
    expect(heist).toBeDefined();
    const blocked = gameService.canUserLaunchGame(heist, {
      arcadeCredits: 100,
      totalWins: 0,
      purchasedComics: []
    });
    expect(blocked.allowed).toBe(false);
    expect(Array.isArray(blocked.reasons)).toBe(true);
  });
});
describe('game session lifecycle', () => {
  afterEach(() => {
    // Clean up any stray sessions between tests
    gameService.listSessions().forEach(session => {
      gameService.endSession(session.sessionId);
    });
  });
  it('creates a blackjack session without auto-starting the round', () => {
    const session = gameService.startSession('blackjack', {
      ownerId: 'tester-1',
      initializeArgs: [2],
      autoStart: false
    });
    expect(session).toBeDefined();
    expect(session.name).toBe('Blackjack');
    expect(session.initializeResult.success).toBe(true);
    expect(session.state).toBeDefined();
    expect(Array.isArray(session.state.players)).toBe(true);
    expect(session.state.players).toHaveLength(2);
    const hitResult = gameService.executeAction(session.sessionId, 'hit', [0], 'tester-1');
    expect(hitResult).toBeDefined();
    expect(hitResult.state).toBeDefined();
  });
  it('supports claw machine sessions with manual movement', () => {
    const session = gameService.startSession('pimpire-claw', {
      ownerId: 'tester-2',
      initializeArgs: [{
        autoStart: false,
        startingEnergy: 3
      }],
      autoStart: false
    });
    expect(session).toBeDefined();
    expect(session.name).toBe('Pimpire Claw');
    expect(session.initializeResult.grid).toBeDefined();
    const move = gameService.executeAction(session.sessionId, 'moveClaw', ['left'], 'tester-2');
    expect(move.result).toEqual({
      success: true,
      position: expect.any(Object)
    });
    expect(move.state).toBeDefined();
    const position = move.state.clawPosition || move.state.position;
    expect(position).toBeDefined();

    // Dispose timers if test introduced any
    gameService.executeAction(session.sessionId, 'dispose', [], 'tester-2');
  });
  it('spins quick slot sessions through the service actions', () => {
    const slotIds = ['diamondz-slot', 'dapaul-smooth-slot', 'golden-cane-slots', 'mink-slot', 'diamonds-high-roller-heist-slot'];
    slotIds.forEach((gameId, index) => {
      const ownerId = `slot-owner-${index}`;
      const session = gameService.startSession(gameId, {
        ownerId,
        autoStart: true
      });
      expect(session).toBeDefined();
      const spin = gameService.executeAction(session.sessionId, 'spin', [], ownerId);
      expect(spin.result).toBeDefined();
      expect(spin.result.success).toBe(true);
      expect(spin.state).toBeDefined();
      expect(typeof spin.state.credits).toBe('number');
      expect(spin.state.credits).toBeGreaterThanOrEqual(0);
      gameService.endSession(session.sessionId);
    });
  });
  it('runs property manager turns with purchases and trades', () => {
    const session = gameService.startSession('pempire-property-manager', {
      ownerId: 'manager-1',
      initializeArgs: [{
        startingBank: 2000,
        winningNetWorth: 1700,
        players: [{
          id: 'p1',
          name: 'Marquis',
          money: 800
        }, {
          id: 'p2',
          name: 'Duchess',
          money: 750
        }]
      }],
      autoStart: true
    });
    expect(session).toBeDefined();
    expect(session.state.players).toHaveLength(2);
    const available = session.state.properties.find(property => !property.ownerId);
    expect(available).toBeDefined();
    const purchase = gameService.executeAction(session.sessionId, 'buyProperty', [available.id, 'p1'], 'manager-1');
    expect(purchase.result.success).toBe(true);
    const updatedProperty = purchase.state.properties.find(property => property.id === available.id);
    expect(updatedProperty.ownerId).toBe('p1');
    const next = gameService.executeAction(session.sessionId, 'nextTurn', [], 'manager-1');
    expect(next.result.success).toBe(true);
    expect(next.state.turn).toBe(1);
    const tradeTarget = purchase.state.properties.find(property => property.ownerId === 'p1');
    const trade = gameService.executeAction(session.sessionId, 'tradeProperty', ['p1', 'p2', tradeTarget.id, 100], 'manager-1');
    expect(trade.result.success).toBe(true);
    const traded = trade.state.properties.find(property => property.id === tradeTarget.id);
    expect(traded.ownerId).toBe('p2');
    gameService.endSession(session.sessionId);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsInByb2Nlc3MiLCJjaGRpciIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJnYW1lU2VydmljZSIsImRlc2NyaWJlIiwiaXQiLCJjYXRhbG9nIiwiZ2V0R2FtZUNhdGFsb2ciLCJleHBlY3RlZCIsImZvckVhY2giLCJpZCIsImZpbGVQYXRoIiwiZW50cnkiLCJmaW5kIiwiZ2FtZSIsImV4cGVjdCIsInRvQmVEZWZpbmVkIiwic291cmNlRmlsZSIsInRvQmUiLCJibGFja2phY2tFbnRyeSIsImhlaXN0IiwiZ2V0R2FtZURldGFpbHMiLCJibG9ja2VkIiwiY2FuVXNlckxhdW5jaEdhbWUiLCJhcmNhZGVDcmVkaXRzIiwidG90YWxXaW5zIiwicHVyY2hhc2VkQ29taWNzIiwiYWxsb3dlZCIsIkFycmF5IiwiaXNBcnJheSIsInJlYXNvbnMiLCJhZnRlckVhY2giLCJsaXN0U2Vzc2lvbnMiLCJzZXNzaW9uIiwiZW5kU2Vzc2lvbiIsInNlc3Npb25JZCIsInN0YXJ0U2Vzc2lvbiIsIm93bmVySWQiLCJpbml0aWFsaXplQXJncyIsImF1dG9TdGFydCIsIm5hbWUiLCJpbml0aWFsaXplUmVzdWx0Iiwic3VjY2VzcyIsInN0YXRlIiwicGxheWVycyIsInRvSGF2ZUxlbmd0aCIsImhpdFJlc3VsdCIsImV4ZWN1dGVBY3Rpb24iLCJzdGFydGluZ0VuZXJneSIsImdyaWQiLCJtb3ZlIiwicmVzdWx0IiwidG9FcXVhbCIsInBvc2l0aW9uIiwiYW55IiwiT2JqZWN0IiwiY2xhd1Bvc2l0aW9uIiwic2xvdElkcyIsImdhbWVJZCIsImluZGV4Iiwic3BpbiIsImNyZWRpdHMiLCJ0b0JlR3JlYXRlclRoYW5PckVxdWFsIiwic3RhcnRpbmdCYW5rIiwid2lubmluZ05ldFdvcnRoIiwibW9uZXkiLCJhdmFpbGFibGUiLCJwcm9wZXJ0aWVzIiwicHJvcGVydHkiLCJwdXJjaGFzZSIsInVwZGF0ZWRQcm9wZXJ0eSIsIm5leHQiLCJ0dXJuIiwidHJhZGVUYXJnZXQiLCJ0cmFkZSIsInRyYWRlZCJdLCJzb3VyY2VzIjpbImdhbWVTZXJ2aWNlLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWVudiBqZXN0ICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbi8vIEVuc3VyZSBOT0RFX1BBVEggc3R5bGUgcmVzb2x1dGlvbiBtaXJyb3JzIHByb2R1Y3Rpb24gcm9vdCBmb3IgZHluYW1pYyByZXF1aXJlc1xucHJvY2Vzcy5jaGRpcihwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nKSk7XG5cbmNvbnN0IGdhbWVTZXJ2aWNlID0gcmVxdWlyZSgnLi4vZGlhbW9uZHotcGxheWhvdXNlL2JhY2tlbmQvc2VydmljZXMvZ2FtZVNlcnZpY2UnKTtcblxuZGVzY3JpYmUoJ2dhbWUgY2F0YWxvZyB3aXJpbmcnLCAoKSA9PiB7XG4gIGl0KCdleHBvc2VzIHRoZSBuZXcgcXVpY2sgZ2FtZSBzdHVicyB3aXRoIHVwZGF0ZWQgc291cmNlIGZpbGVzJywgKCkgPT4ge1xuICAgIGNvbnN0IGNhdGFsb2cgPSBnYW1lU2VydmljZS5nZXRHYW1lQ2F0YWxvZygpO1xuICAgIGNvbnN0IGV4cGVjdGVkID0gW1xuICAgICAgWydwaW1waXJlLWNsYXcnLCAnU291cmNlQ29kZS9RdWlja0dhbWVzL1BpbXBpcmVDbGF3LmpzJ10sXG4gICAgICBbJ2RpYW1vbmR6LXNsb3QnLCAnU291cmNlQ29kZS9RdWlja0dhbWVzL0RpYW1vbmR6U2xvdC5qcyddLFxuICAgICAgWydkYXBhdWwtc21vb3RoLXNsb3QnLCAnU291cmNlQ29kZS9RdWlja0dhbWVzL0RhcGF1bFNtb290aFNsb3QuanMnXSxcbiAgICAgIFsnZ29sZGVuLWNhbmUtc2xvdHMnLCAnU291cmNlQ29kZS9RdWlja0dhbWVzL0dvbGRlbkNhbmVTbG90cy5qcyddLFxuICAgICAgWydtaW5rLXNsb3QnLCAnU291cmNlQ29kZS9RdWlja0dhbWVzL01pbmtTbG90LmpzJ10sXG4gICAgICBbJ2RpYW1vbmRzLWhpZ2gtcm9sbGVyLWhlaXN0LXNsb3QnLCAnU291cmNlQ29kZS9RdWlja0dhbWVzL0RpYW1vbmRzSGlnaFJvbGxlckhlaXN0U2xvdC5qcyddXG4gICAgXTtcblxuICAgIGV4cGVjdGVkLmZvckVhY2goKFtpZCwgZmlsZVBhdGhdKSA9PiB7XG4gICAgICBjb25zdCBlbnRyeSA9IGNhdGFsb2cuZmluZCgoZ2FtZSkgPT4gZ2FtZS5pZCA9PT0gaWQpO1xuICAgICAgZXhwZWN0KGVudHJ5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGVudHJ5LnNvdXJjZUZpbGUpLnRvQmUoZmlsZVBhdGgpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgYmxhY2tqYWNrRW50cnkgPSBjYXRhbG9nLmZpbmQoKGVudHJ5KSA9PiBlbnRyeS5pZCA9PT0gJ2JsYWNramFjaycpO1xuICAgIGV4cGVjdChibGFja2phY2tFbnRyeSkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QoYmxhY2tqYWNrRW50cnkuc291cmNlRmlsZSkudG9CZSgnU291cmNlQ29kZS9DYXJkR2FtZXMvQmxhY2tqYWNrLmpzJyk7XG4gIH0pO1xuXG4gIGl0KCd2YWxpZGF0ZXMgYWNjZXNzIHJ1bGVzIGFnYWluc3QgdXNlciBwcm9maWxlJywgKCkgPT4ge1xuICAgIGNvbnN0IGhlaXN0ID0gZ2FtZVNlcnZpY2UuZ2V0R2FtZURldGFpbHMoJ2RpYW1vbmQtaGVpc3QtY29pbi1kb3plcicpO1xuICAgIGV4cGVjdChoZWlzdCkudG9CZURlZmluZWQoKTtcblxuICAgIGNvbnN0IGJsb2NrZWQgPSBnYW1lU2VydmljZS5jYW5Vc2VyTGF1bmNoR2FtZShoZWlzdCwge1xuICAgICAgYXJjYWRlQ3JlZGl0czogMTAwLFxuICAgICAgdG90YWxXaW5zOiAwLFxuICAgICAgcHVyY2hhc2VkQ29taWNzOiBbXVxuICAgIH0pO1xuICAgIGV4cGVjdChibG9ja2VkLmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xuICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGJsb2NrZWQucmVhc29ucykpLnRvQmUodHJ1ZSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdnYW1lIHNlc3Npb24gbGlmZWN5Y2xlJywgKCkgPT4ge1xuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIC8vIENsZWFuIHVwIGFueSBzdHJheSBzZXNzaW9ucyBiZXR3ZWVuIHRlc3RzXG4gICAgZ2FtZVNlcnZpY2UubGlzdFNlc3Npb25zKCkuZm9yRWFjaCgoc2Vzc2lvbikgPT4ge1xuICAgICAgZ2FtZVNlcnZpY2UuZW5kU2Vzc2lvbihzZXNzaW9uLnNlc3Npb25JZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdjcmVhdGVzIGEgYmxhY2tqYWNrIHNlc3Npb24gd2l0aG91dCBhdXRvLXN0YXJ0aW5nIHRoZSByb3VuZCcsICgpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gZ2FtZVNlcnZpY2Uuc3RhcnRTZXNzaW9uKCdibGFja2phY2snLCB7XG4gICAgICBvd25lcklkOiAndGVzdGVyLTEnLFxuICAgICAgaW5pdGlhbGl6ZUFyZ3M6IFsyXSxcbiAgICAgIGF1dG9TdGFydDogZmFsc2VcbiAgICB9KTtcblxuICAgIGV4cGVjdChzZXNzaW9uKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChzZXNzaW9uLm5hbWUpLnRvQmUoJ0JsYWNramFjaycpO1xuICAgIGV4cGVjdChzZXNzaW9uLmluaXRpYWxpemVSZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICBleHBlY3Qoc2Vzc2lvbi5zdGF0ZSkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QoQXJyYXkuaXNBcnJheShzZXNzaW9uLnN0YXRlLnBsYXllcnMpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChzZXNzaW9uLnN0YXRlLnBsYXllcnMpLnRvSGF2ZUxlbmd0aCgyKTtcblxuICAgIGNvbnN0IGhpdFJlc3VsdCA9IGdhbWVTZXJ2aWNlLmV4ZWN1dGVBY3Rpb24oc2Vzc2lvbi5zZXNzaW9uSWQsICdoaXQnLCBbMF0sICd0ZXN0ZXItMScpO1xuICAgIGV4cGVjdChoaXRSZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KGhpdFJlc3VsdC5zdGF0ZSkudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgaXQoJ3N1cHBvcnRzIGNsYXcgbWFjaGluZSBzZXNzaW9ucyB3aXRoIG1hbnVhbCBtb3ZlbWVudCcsICgpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gZ2FtZVNlcnZpY2Uuc3RhcnRTZXNzaW9uKCdwaW1waXJlLWNsYXcnLCB7XG4gICAgICBvd25lcklkOiAndGVzdGVyLTInLFxuICAgICAgaW5pdGlhbGl6ZUFyZ3M6IFt7IGF1dG9TdGFydDogZmFsc2UsIHN0YXJ0aW5nRW5lcmd5OiAzIH1dLFxuICAgICAgYXV0b1N0YXJ0OiBmYWxzZVxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHNlc3Npb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KHNlc3Npb24ubmFtZSkudG9CZSgnUGltcGlyZSBDbGF3Jyk7XG4gICAgZXhwZWN0KHNlc3Npb24uaW5pdGlhbGl6ZVJlc3VsdC5ncmlkKS50b0JlRGVmaW5lZCgpO1xuXG4gICAgY29uc3QgbW92ZSA9IGdhbWVTZXJ2aWNlLmV4ZWN1dGVBY3Rpb24oc2Vzc2lvbi5zZXNzaW9uSWQsICdtb3ZlQ2xhdycsIFsnbGVmdCddLCAndGVzdGVyLTInKTtcbiAgICBleHBlY3QobW92ZS5yZXN1bHQpLnRvRXF1YWwoeyBzdWNjZXNzOiB0cnVlLCBwb3NpdGlvbjogZXhwZWN0LmFueShPYmplY3QpIH0pO1xuICAgIGV4cGVjdChtb3ZlLnN0YXRlKS50b0JlRGVmaW5lZCgpO1xuICAgIGNvbnN0IHBvc2l0aW9uID0gbW92ZS5zdGF0ZS5jbGF3UG9zaXRpb24gfHwgbW92ZS5zdGF0ZS5wb3NpdGlvbjtcbiAgICBleHBlY3QocG9zaXRpb24pLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAvLyBEaXNwb3NlIHRpbWVycyBpZiB0ZXN0IGludHJvZHVjZWQgYW55XG4gICAgZ2FtZVNlcnZpY2UuZXhlY3V0ZUFjdGlvbihzZXNzaW9uLnNlc3Npb25JZCwgJ2Rpc3Bvc2UnLCBbXSwgJ3Rlc3Rlci0yJyk7XG4gIH0pO1xuXG4gIGl0KCdzcGlucyBxdWljayBzbG90IHNlc3Npb25zIHRocm91Z2ggdGhlIHNlcnZpY2UgYWN0aW9ucycsICgpID0+IHtcbiAgICBjb25zdCBzbG90SWRzID0gW1xuICAgICAgJ2RpYW1vbmR6LXNsb3QnLFxuICAgICAgJ2RhcGF1bC1zbW9vdGgtc2xvdCcsXG4gICAgICAnZ29sZGVuLWNhbmUtc2xvdHMnLFxuICAgICAgJ21pbmstc2xvdCcsXG4gICAgICAnZGlhbW9uZHMtaGlnaC1yb2xsZXItaGVpc3Qtc2xvdCdcbiAgICBdO1xuXG4gICAgc2xvdElkcy5mb3JFYWNoKChnYW1lSWQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBvd25lcklkID0gYHNsb3Qtb3duZXItJHtpbmRleH1gO1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGdhbWVTZXJ2aWNlLnN0YXJ0U2Vzc2lvbihnYW1lSWQsIHtcbiAgICAgICAgb3duZXJJZCxcbiAgICAgICAgYXV0b1N0YXJ0OiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHNlc3Npb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBjb25zdCBzcGluID0gZ2FtZVNlcnZpY2UuZXhlY3V0ZUFjdGlvbihzZXNzaW9uLnNlc3Npb25JZCwgJ3NwaW4nLCBbXSwgb3duZXJJZCk7XG4gICAgICBleHBlY3Qoc3Bpbi5yZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qoc3Bpbi5yZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzcGluLnN0YXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBzcGluLnN0YXRlLmNyZWRpdHMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHNwaW4uc3RhdGUuY3JlZGl0cykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcblxuICAgICAgZ2FtZVNlcnZpY2UuZW5kU2Vzc2lvbihzZXNzaW9uLnNlc3Npb25JZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdydW5zIHByb3BlcnR5IG1hbmFnZXIgdHVybnMgd2l0aCBwdXJjaGFzZXMgYW5kIHRyYWRlcycsICgpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gZ2FtZVNlcnZpY2Uuc3RhcnRTZXNzaW9uKCdwZW1waXJlLXByb3BlcnR5LW1hbmFnZXInLCB7XG4gICAgICBvd25lcklkOiAnbWFuYWdlci0xJyxcbiAgICAgIGluaXRpYWxpemVBcmdzOiBbe1xuICAgICAgICBzdGFydGluZ0Jhbms6IDIwMDAsXG4gICAgICAgIHdpbm5pbmdOZXRXb3J0aDogMTcwMCxcbiAgICAgICAgcGxheWVyczogW1xuICAgICAgICAgIHsgaWQ6ICdwMScsIG5hbWU6ICdNYXJxdWlzJywgbW9uZXk6IDgwMCB9LFxuICAgICAgICAgIHsgaWQ6ICdwMicsIG5hbWU6ICdEdWNoZXNzJywgbW9uZXk6IDc1MCB9XG4gICAgICAgIF1cbiAgICAgIH1dLFxuICAgICAgYXV0b1N0YXJ0OiB0cnVlXG4gICAgfSk7XG5cbiAgICBleHBlY3Qoc2Vzc2lvbikudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3Qoc2Vzc2lvbi5zdGF0ZS5wbGF5ZXJzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgY29uc3QgYXZhaWxhYmxlID0gc2Vzc2lvbi5zdGF0ZS5wcm9wZXJ0aWVzLmZpbmQoKHByb3BlcnR5KSA9PiAhcHJvcGVydHkub3duZXJJZCk7XG4gICAgZXhwZWN0KGF2YWlsYWJsZSkudG9CZURlZmluZWQoKTtcblxuICAgIGNvbnN0IHB1cmNoYXNlID0gZ2FtZVNlcnZpY2UuZXhlY3V0ZUFjdGlvbihcbiAgICAgIHNlc3Npb24uc2Vzc2lvbklkLFxuICAgICAgJ2J1eVByb3BlcnR5JyxcbiAgICAgIFthdmFpbGFibGUuaWQsICdwMSddLFxuICAgICAgJ21hbmFnZXItMSdcbiAgICApO1xuICAgIGV4cGVjdChwdXJjaGFzZS5yZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICBjb25zdCB1cGRhdGVkUHJvcGVydHkgPSBwdXJjaGFzZS5zdGF0ZS5wcm9wZXJ0aWVzLmZpbmQoKHByb3BlcnR5KSA9PiBwcm9wZXJ0eS5pZCA9PT0gYXZhaWxhYmxlLmlkKTtcbiAgICBleHBlY3QodXBkYXRlZFByb3BlcnR5Lm93bmVySWQpLnRvQmUoJ3AxJyk7XG5cbiAgICBjb25zdCBuZXh0ID0gZ2FtZVNlcnZpY2UuZXhlY3V0ZUFjdGlvbihzZXNzaW9uLnNlc3Npb25JZCwgJ25leHRUdXJuJywgW10sICdtYW5hZ2VyLTEnKTtcbiAgICBleHBlY3QobmV4dC5yZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICBleHBlY3QobmV4dC5zdGF0ZS50dXJuKS50b0JlKDEpO1xuXG4gICAgY29uc3QgdHJhZGVUYXJnZXQgPSBwdXJjaGFzZS5zdGF0ZS5wcm9wZXJ0aWVzLmZpbmQoKHByb3BlcnR5KSA9PiBwcm9wZXJ0eS5vd25lcklkID09PSAncDEnKTtcbiAgICBjb25zdCB0cmFkZSA9IGdhbWVTZXJ2aWNlLmV4ZWN1dGVBY3Rpb24oXG4gICAgICBzZXNzaW9uLnNlc3Npb25JZCxcbiAgICAgICd0cmFkZVByb3BlcnR5JyxcbiAgICAgIFtcbiAgICAgICAgJ3AxJyxcbiAgICAgICAgJ3AyJyxcbiAgICAgICAgdHJhZGVUYXJnZXQuaWQsXG4gICAgICAgIDEwMFxuICAgICAgXSxcbiAgICAgICdtYW5hZ2VyLTEnXG4gICAgKTtcbiAgICBleHBlY3QodHJhZGUucmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgY29uc3QgdHJhZGVkID0gdHJhZGUuc3RhdGUucHJvcGVydGllcy5maW5kKChwcm9wZXJ0eSkgPT4gcHJvcGVydHkuaWQgPT09IHRyYWRlVGFyZ2V0LmlkKTtcbiAgICBleHBlY3QodHJhZGVkLm93bmVySWQpLnRvQmUoJ3AyJyk7XG5cbiAgICBnYW1lU2VydmljZS5lbmRTZXNzaW9uKHNlc3Npb24uc2Vzc2lvbklkKTtcbiAgfSk7XG59KTtc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S0FBSyxDQUFDd0IsVUFBVSxDQUFDdEQsSUFBSSxDQUFFdUQsUUFBUSxJQUFLQSxRQUFRLENBQUMxRCxFQUFFLEtBQUt3RCxTQUFTLENBQUN4RCxFQUFFLENBQUM7SUFDbEdLLE1BQU0sQ0FBQ3VELGVBQWUsQ0FBQ2pDLE9BQU8sQ0FBQyxDQUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQztJQUUxQyxNQUFNcUQsSUFBSSxHQUFHcEUsV0FBVyxDQUFDNEMsYUFBYSxDQUFDZCxPQUFPLENBQUNFLFNBQVMsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLFdBQVcsQ0FBQztJQUN0RnBCLE1BQU0sQ0FBQ3dELElBQUksQ0FBQ3BCLE1BQU0sQ0FBQ1QsT0FBTyxDQUFDLENBQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ3RDSCxNQUFNLENBQUN3RCxJQUFJLENBQUM1QixLQUFLLENBQUM2QixJQUFJLENBQUMsQ0FBQ3RELElBQUksQ0FBQyxDQUFDLENBQUM7SUFFL0IsTUFBTXVELFdBQVcsR0FBR0osUUFBUSxDQUFDMUIsS0FBSyxDQUFDd0IsVUFBVSxDQUFDdEQsSUFBSSxDQUFFdUQsUUFBUSxJQUFLQSxRQUFRLENBQUMvQixPQUFPLEtBQUssSUFBSSxDQUFDO0lBQzNGLE1BQU1xQyxLQUFLLEdBQUd2RSxXQUFXLENBQUM0QyxhQUFhLENBQ3JDZCxPQUFPLENBQUNFLFNBQVMsRUFDakIsZUFBZSxFQUNmLENBQ0UsSUFBSSxFQUNKLElBQUksRUFDSnNDLFdBQVcsQ0FBQy9ELEVBQUUsRUFDZCxHQUFHLENBQ0osRUFDRCxXQUNGLENBQUM7SUFDREssTUFBTSxDQUFDMkQsS0FBSyxDQUFDdkIsTUFBTSxDQUFDVCxPQUFPLENBQUMsQ0FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDdkMsTUFBTXlELE1BQU0sR0FBR0QsS0FBSyxDQUFDL0IsS0FBSyxDQUFDd0IsVUFBVSxDQUFDdEQsSUFBSSxDQUFFdUQsUUFBUSxJQUFLQSxRQUFRLENBQUMxRCxFQUFFLEtBQUsrRCxXQUFXLENBQUMvRCxFQUFFLENBQUM7SUFDeEZLLE1BQU0sQ0FBQzRELE1BQU0sQ0FBQ3RDLE9BQU8sQ0FBQyxDQUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQztJQUVqQ2YsV0FBVyxDQUFDK0IsVUFBVSxDQUFDRCxPQUFPLENBQUNFLFNBQVMsQ0FBQztFQUMzQyxDQUFDLENBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=