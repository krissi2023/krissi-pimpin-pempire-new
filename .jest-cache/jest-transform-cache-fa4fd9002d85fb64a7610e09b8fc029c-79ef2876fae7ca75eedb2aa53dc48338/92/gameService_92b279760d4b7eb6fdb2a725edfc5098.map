{"version":3,"names":["path","require","categories","games","ACTIVE_SESSIONS","Map","PROJECT_ROOT","resolve","__dirname","normalizeArgs","value","Array","isArray","formatCredits","Number","isNaN","toFixed","collectUserComicIds","user","purchasedComics","Set","map","entry","comicId","captureState","instance","getGameState","err","error","message","getState","snapshot","simpleFields","forEach","field","clawPosition","players","dealerHand","prizeGrid","firewalls","Object","keys","length","toClientSession","session","extra","sessionId","gameId","name","type","ownerId","createdAt","lastInteraction","metadata","state","getCategoriesWithGames","category","filter","game","key","getGameCatalog","slice","getGameDetails","find","id","categoryDetails","access","loadGameClass","sourceFile","Error","modulePath","join","GameModule","normalizeOwner","toString","ensureOwnership","normalizedOwner","canUserLaunchGame","allowed","reason","reasons","creditsRequired","minArcadeCredits","availableCredits","arcadeCredits","formatted","push","requiresVip","isVip","minTotalWins","totalWins","requiredComicIds","ownedComicIds","missingComics","has","titles","requiredComicTitles","startSession","options","GameClass","Date","now","Math","random","minPlayers","maxPlayers","minBet","maxBet","unlockRequirement","description","initializeArgs","initializeResult","initialize","startResult","autoStart","startArgs","start","startGame","set","getSession","get","getSessionForOwner","executeAction","action","args","target","result","apply","endSession","delete","endedAt","endSessionForOwner","listSessions","entries","from","values","filtered","module","exports"],"sources":["gameService.js"],"sourcesContent":["'use strict';\n\nconst path = require('path');\nconst { categories, games } = require('../data/arcadeGames');\n\nconst ACTIVE_SESSIONS = new Map();\nconst PROJECT_ROOT = path.resolve(__dirname, '..', '..', '..');\n\nconst normalizeArgs = (value) => {\n  if (Array.isArray(value)) {\n    return value;\n  }\n  if (typeof value === 'undefined' || value === null) {\n    return [];\n  }\n  return [value];\n};\n\nconst formatCredits = (value) => {\n  if (typeof value !== 'number' || Number.isNaN(value) || value <= 0) {\n    return null;\n  }\n  return `$${(value / 100).toFixed(2)}`;\n};\n\nconst collectUserComicIds = (user) => {\n  if (!user || !Array.isArray(user.purchasedComics)) {\n    return new Set();\n  }\n  return new Set(user.purchasedComics.map((entry) => entry.comicId));\n};\n\nconst captureState = (instance) => {\n  if (!instance) {\n    return null;\n  }\n\n  if (typeof instance.getGameState === 'function') {\n    try {\n      return instance.getGameState();\n    } catch (err) {\n      return { error: err.message };\n    }\n  }\n\n  if (typeof instance.getState === 'function') {\n    try {\n      return instance.getState();\n    } catch (err) {\n      return { error: err.message };\n    }\n  }\n\n  const snapshot = {};\n  const simpleFields = [\n    'score',\n    'playerScore',\n    'computerScore',\n    'gamesPlayed',\n    'remainingTime',\n    'isRunning',\n    'energy',\n    'streak',\n    'comboMultiplier'\n  ];\n\n  simpleFields.forEach((field) => {\n    if (typeof instance[field] !== 'undefined') {\n      snapshot[field] = instance[field];\n    }\n  });\n\n  if (instance.clawPosition) {\n    snapshot.clawPosition = instance.clawPosition;\n  }\n\n  if (Array.isArray(instance.players)) {\n    snapshot.players = instance.players;\n  }\n\n  if (Array.isArray(instance.dealerHand)) {\n    snapshot.dealerHand = instance.dealerHand;\n  }\n\n  if (Array.isArray(instance.prizeGrid)) {\n    snapshot.prizeGrid = instance.prizeGrid;\n  }\n\n  if (Array.isArray(instance.firewalls)) {\n    snapshot.firewalls = instance.firewalls;\n  }\n\n  return Object.keys(snapshot).length > 0 ? snapshot : null;\n};\n\nconst toClientSession = (session, extra = {}) => ({\n  sessionId: session.sessionId,\n  gameId: session.gameId,\n  name: session.name,\n  type: session.type,\n  ownerId: session.ownerId,\n  createdAt: session.createdAt,\n  lastInteraction: session.lastInteraction,\n  metadata: session.metadata,\n  state: captureState(session.instance),\n  ...extra\n});\n\nconst getCategoriesWithGames = () =>\n  categories\n    .map((category) => ({\n      ...category,\n      games: games.filter((game) => game.category === category.key)\n    }))\n    .filter((category) => category.games.length > 0);\n\nconst getGameCatalog = () => games.slice();\n\nconst getGameDetails = (gameId) => {\n  const game = games.find((entry) => entry.id === gameId);\n  if (!game) {\n    return null;\n  }\n  const category = categories.find((entry) => entry.key === game.category) || null;\n  return {\n    ...game,\n    categoryDetails: category,\n    access: game.access || {}\n  };\n};\n\nconst loadGameClass = (game) => {\n  if (!game.sourceFile) {\n    throw new Error('Game source file is not defined');\n  }\n  const modulePath = path.join(PROJECT_ROOT, game.sourceFile);\n  // eslint-disable-next-line global-require\n  const GameModule = require(modulePath);\n  if (typeof GameModule !== 'function') {\n    throw new Error(`Game module ${game.sourceFile} does not export a constructor`);\n  }\n  return GameModule;\n};\n\nconst normalizeOwner = (ownerId) => {\n  if (!ownerId) {\n    throw new Error('Owner id is required for session management');\n  }\n  return ownerId.toString();\n};\n\nconst ensureOwnership = (session, ownerId) => {\n  if (!session) {\n    return null;\n  }\n  const normalizedOwner = normalizeOwner(ownerId);\n  return session.ownerId === normalizedOwner ? session : null;\n};\n\nconst canUserLaunchGame = (game, user) => {\n  if (!user) {\n    return {\n      allowed: false,\n      reason: 'User information is required to validate access.'\n    };\n  }\n\n  const access = game.access || {};\n  const reasons = [];\n\n  const creditsRequired = typeof access.minArcadeCredits === 'number' ? access.minArcadeCredits : null;\n  const availableCredits = typeof user.arcadeCredits === 'number' ? user.arcadeCredits : 0;\n  if (creditsRequired && availableCredits < creditsRequired) {\n    const formatted = formatCredits(creditsRequired) || `${creditsRequired} credits`;\n    reasons.push(`Requires at least ${formatted} in arcade credits.`);\n  }\n\n  if (access.requiresVip && !user.isVip) {\n    reasons.push('VIP Lounge access is required for this cabinet.');\n  }\n\n  if (typeof access.minTotalWins === 'number' && user.totalWins < access.minTotalWins) {\n    reasons.push(`Win ${access.minTotalWins} arcade matches to unlock this cabinet.`);\n  }\n\n  if (Array.isArray(access.requiredComicIds) && access.requiredComicIds.length > 0) {\n    const ownedComicIds = collectUserComicIds(user);\n    const missingComics = access.requiredComicIds.filter((comicId) => !ownedComicIds.has(comicId));\n    if (missingComics.length > 0) {\n      const titles = Array.isArray(access.requiredComicTitles) && access.requiredComicTitles.length > 0\n        ? access.requiredComicTitles\n        : missingComics;\n      reasons.push(`Purchase ${titles.join(', ')} to unlock this cabinet.`);\n    }\n  }\n\n  if (reasons.length > 0) {\n    return {\n      allowed: false,\n      reason: reasons.join(' '),\n      reasons\n    };\n  }\n\n  return {\n    allowed: true\n  };\n};\n\nconst startSession = (gameId, options = {}) => {\n  const game = games.find((entry) => entry.id === gameId);\n  if (!game) {\n    throw new Error('Game not found');\n  }\n\n  const ownerId = normalizeOwner(options.ownerId);\n\n  const GameClass = loadGameClass(game);\n  const instance = new GameClass();\n  const sessionId = `sess_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n\n  const session = {\n    sessionId,\n    instance,\n    gameId: game.id,\n    name: game.name,\n    type: game.type,\n    ownerId,\n    metadata: {\n      minPlayers: game.minPlayers || null,\n      maxPlayers: game.maxPlayers || null,\n      minBet: game.minBet || null,\n      maxBet: game.maxBet || null,\n      unlockRequirement: game.unlockRequirement || null,\n      description: game.description || null,\n      access: game.access || {}\n    },\n    createdAt: new Date(),\n    lastInteraction: new Date()\n  };\n\n  const initializeArgs = normalizeArgs(options.initializeArgs);\n  let initializeResult = null;\n  if (typeof instance.initialize === 'function') {\n    initializeResult = instance.initialize(...initializeArgs);\n  }\n\n  let startResult = null;\n  if (options.autoStart !== false) {\n    const startArgs = normalizeArgs(options.startArgs);\n    if (typeof instance.start === 'function') {\n      startResult = instance.start(...startArgs);\n    } else if (typeof instance.startGame === 'function') {\n      startResult = instance.startGame(...startArgs);\n    }\n  }\n\n  ACTIVE_SESSIONS.set(sessionId, session);\n\n  return toClientSession(session, {\n    initializeResult,\n    startResult\n  });\n};\n\nconst getSession = (sessionId) => {\n  const session = ACTIVE_SESSIONS.get(sessionId);\n  if (!session) {\n    return null;\n  }\n  return toClientSession(session);\n};\n\nconst getSessionForOwner = (sessionId, ownerId) => {\n  const session = ensureOwnership(ACTIVE_SESSIONS.get(sessionId), ownerId);\n  if (!session) {\n    return null;\n  }\n  return toClientSession(session);\n};\n\nconst executeAction = (sessionId, action, args = [], ownerId) => {\n  const session = ensureOwnership(ACTIVE_SESSIONS.get(sessionId), ownerId);\n  if (!session) {\n    throw new Error('Session not found');\n  }\n  if (!action || typeof action !== 'string') {\n    throw new Error('Action name is required');\n  }\n  const target = session.instance[action];\n  if (typeof target !== 'function') {\n    throw new Error(`Action ${action} is not supported by this game`);\n  }\n  const result = target.apply(session.instance, normalizeArgs(args));\n  session.lastInteraction = new Date();\n  return {\n    result,\n    state: captureState(session.instance)\n  };\n};\n\nconst endSession = (sessionId) => {\n  const session = ACTIVE_SESSIONS.get(sessionId);\n  if (!session) {\n    return null;\n  }\n  ACTIVE_SESSIONS.delete(sessionId);\n  return {\n    sessionId,\n    endedAt: new Date()\n  };\n};\n\nconst endSessionForOwner = (sessionId, ownerId) => {\n  const session = ensureOwnership(ACTIVE_SESSIONS.get(sessionId), ownerId);\n  if (!session) {\n    return null;\n  }\n  ACTIVE_SESSIONS.delete(sessionId);\n  return {\n    sessionId,\n    endedAt: new Date()\n  };\n};\n\nconst listSessions = (ownerId = null) => {\n  const entries = Array.from(ACTIVE_SESSIONS.values());\n  const filtered = ownerId ? entries.filter((session) => session.ownerId === normalizeOwner(ownerId)) : entries;\n  return filtered.map((session) => toClientSession(session));\n};\n\nmodule.exports = {\n  getCategoriesWithGames,\n  getGameCatalog,\n  getGameDetails,\n  startSession,\n  getSession,\n  getSessionForOwner,\n  executeAction,\n  endSession,\n  endSessionForOwner,\n  listSessions,\n  canUserLaunchGame\n};\n"],"mappings":"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","ignoreList":[]}