4c5e629a94180328da3c2a14f1462992
'use strict';

/**
 * Game: Diamondz Slot Machine
 * Classic slot machine - spin reels, match diamonds, win jackpot.
 */
const SYMBOLS = ['DIAMOND', 'CHERRY', 'BELL', 'LEMON', 'SEVEN', 'BAR'];
class DiamondzSlot {
  constructor(options = {}) {
    this.spinCost = this.normalizeNumber(options.spinCost, 5);
    this.credits = this.normalizeNumber(options.startingCredits, 100);
    this.resetState();
  }
  initialize(options = {}) {
    if (typeof options.startingCredits === 'number') {
      this.credits = this.normalizeNumber(options.startingCredits, this.credits);
    }
    if (typeof options.spinCost === 'number') {
      this.spinCost = this.normalizeNumber(options.spinCost, this.spinCost);
    }
    this.resetState();
    return this.getState();
  }
  startGame() {
    this.resetState();
    return this.getState();
  }
  generateReels() {
    const reels = [];
    for (let i = 0; i < 3; i += 1) {
      reels.push(SYMBOLS.slice());
    }
    return reels;
  }
  spin() {
    if (this.isSpinning) {
      return {
        success: false,
        message: 'Unable to spin right now.'
      };
    }
    if (this.credits < this.spinCost) {
      return {
        success: false,
        message: 'Not enough credits.'
      };
    }
    this.isSpinning = true;
    this.credits -= this.spinCost;
    this.lastSpinResult = this.reels.map(symbols => symbols[Math.floor(Math.random() * symbols.length)]);
    this.evaluateSpin();
    this.isSpinning = false;
    return {
      success: true,
      result: this.lastSpinResult.slice(),
      credits: this.credits,
      winAmount: this.winAmount,
      state: this.getState()
    };
  }
  evaluateSpin() {
    if (this.lastSpinResult.length === 0) {
      this.winAmount = 0;
      return;
    }
    if (this.lastSpinResult.every(symbol => symbol === 'DIAMOND')) {
      this.winAmount = 520;
      this.credits += this.winAmount;
      return;
    }
    if (new Set(this.lastSpinResult).size === 1) {
      this.winAmount = 110;
      this.credits += this.winAmount;
      return;
    }
    if (this.lastSpinResult.filter(symbol => symbol === 'DIAMOND').length === 2) {
      this.winAmount = 45;
      this.credits += this.winAmount;
      return;
    }
    this.winAmount = 0;
  }
  getState() {
    return {
      credits: this.credits,
      lastSpinResult: this.lastSpinResult.slice(),
      winAmount: this.winAmount,
      spinCost: this.spinCost
    };
  }
  resetState() {
    this.reels = this.generateReels();
    this.isSpinning = false;
    this.lastSpinResult = [];
    this.winAmount = 0;
  }
  normalizeNumber(value, fallback) {
    if (typeof value !== 'number' || Number.isNaN(value) || value <= 0) {
      return fallback;
    }
    return Math.floor(value);
  }
}
module.exports = DiamondzSlot;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTWU1CT0xTIiwiRGlhbW9uZHpTbG90IiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwic3BpbkNvc3QiLCJub3JtYWxpemVOdW1iZXIiLCJjcmVkaXRzIiwic3RhcnRpbmdDcmVkaXRzIiwicmVzZXRTdGF0ZSIsImluaXRpYWxpemUiLCJnZXRTdGF0ZSIsInN0YXJ0R2FtZSIsImdlbmVyYXRlUmVlbHMiLCJyZWVscyIsImkiLCJwdXNoIiwic2xpY2UiLCJzcGluIiwiaXNTcGlubmluZyIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwibGFzdFNwaW5SZXN1bHQiLCJtYXAiLCJzeW1ib2xzIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwiZXZhbHVhdGVTcGluIiwicmVzdWx0Iiwid2luQW1vdW50Iiwic3RhdGUiLCJldmVyeSIsInN5bWJvbCIsIlNldCIsInNpemUiLCJmaWx0ZXIiLCJ2YWx1ZSIsImZhbGxiYWNrIiwiTnVtYmVyIiwiaXNOYU4iLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiRGlhbW9uZHpTbG90LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBHYW1lOiBEaWFtb25keiBTbG90IE1hY2hpbmVcbiAqIENsYXNzaWMgc2xvdCBtYWNoaW5lIC0gc3BpbiByZWVscywgbWF0Y2ggZGlhbW9uZHMsIHdpbiBqYWNrcG90LlxuICovXG5cbmNvbnN0IFNZTUJPTFMgPSBbJ0RJQU1PTkQnLCAnQ0hFUlJZJywgJ0JFTEwnLCAnTEVNT04nLCAnU0VWRU4nLCAnQkFSJ107XG5cbmNsYXNzIERpYW1vbmR6U2xvdCB7XG5cdGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuXHRcdHRoaXMuc3BpbkNvc3QgPSB0aGlzLm5vcm1hbGl6ZU51bWJlcihvcHRpb25zLnNwaW5Db3N0LCA1KTtcblx0XHR0aGlzLmNyZWRpdHMgPSB0aGlzLm5vcm1hbGl6ZU51bWJlcihvcHRpb25zLnN0YXJ0aW5nQ3JlZGl0cywgMTAwKTtcblx0XHR0aGlzLnJlc2V0U3RhdGUoKTtcblx0fVxuXG5cdGluaXRpYWxpemUob3B0aW9ucyA9IHt9KSB7XG5cdFx0aWYgKHR5cGVvZiBvcHRpb25zLnN0YXJ0aW5nQ3JlZGl0cyA9PT0gJ251bWJlcicpIHtcblx0XHRcdHRoaXMuY3JlZGl0cyA9IHRoaXMubm9ybWFsaXplTnVtYmVyKG9wdGlvbnMuc3RhcnRpbmdDcmVkaXRzLCB0aGlzLmNyZWRpdHMpO1xuXHRcdH1cblx0XHRpZiAodHlwZW9mIG9wdGlvbnMuc3BpbkNvc3QgPT09ICdudW1iZXInKSB7XG5cdFx0XHR0aGlzLnNwaW5Db3N0ID0gdGhpcy5ub3JtYWxpemVOdW1iZXIob3B0aW9ucy5zcGluQ29zdCwgdGhpcy5zcGluQ29zdCk7XG5cdFx0fVxuXHRcdHRoaXMucmVzZXRTdGF0ZSgpO1xuXHRcdHJldHVybiB0aGlzLmdldFN0YXRlKCk7XG5cdH1cblxuXHRzdGFydEdhbWUoKSB7XG5cdFx0dGhpcy5yZXNldFN0YXRlKCk7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0U3RhdGUoKTtcblx0fVxuXG5cdGdlbmVyYXRlUmVlbHMoKSB7XG5cdFx0Y29uc3QgcmVlbHMgPSBbXTtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkgKz0gMSkge1xuXHRcdFx0cmVlbHMucHVzaChTWU1CT0xTLnNsaWNlKCkpO1xuXHRcdH1cblx0XHRyZXR1cm4gcmVlbHM7XG5cdH1cblxuXHRzcGluKCkge1xuXHRcdGlmICh0aGlzLmlzU3Bpbm5pbmcpIHtcblx0XHRcdHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnVW5hYmxlIHRvIHNwaW4gcmlnaHQgbm93LicgfTtcblx0XHR9XG5cdFx0aWYgKHRoaXMuY3JlZGl0cyA8IHRoaXMuc3BpbkNvc3QpIHtcblx0XHRcdHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnTm90IGVub3VnaCBjcmVkaXRzLicgfTtcblx0XHR9XG5cblx0XHR0aGlzLmlzU3Bpbm5pbmcgPSB0cnVlO1xuXHRcdHRoaXMuY3JlZGl0cyAtPSB0aGlzLnNwaW5Db3N0O1xuXG5cdFx0dGhpcy5sYXN0U3BpblJlc3VsdCA9IHRoaXMucmVlbHMubWFwKChzeW1ib2xzKSA9PiBzeW1ib2xzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHN5bWJvbHMubGVuZ3RoKV0pO1xuXHRcdHRoaXMuZXZhbHVhdGVTcGluKCk7XG5cdFx0dGhpcy5pc1NwaW5uaW5nID0gZmFsc2U7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0c3VjY2VzczogdHJ1ZSxcblx0XHRcdHJlc3VsdDogdGhpcy5sYXN0U3BpblJlc3VsdC5zbGljZSgpLFxuXHRcdFx0Y3JlZGl0czogdGhpcy5jcmVkaXRzLFxuXHRcdFx0d2luQW1vdW50OiB0aGlzLndpbkFtb3VudCxcblx0XHRcdHN0YXRlOiB0aGlzLmdldFN0YXRlKClcblx0XHR9O1xuXHR9XG5cblx0ZXZhbHVhdGVTcGluKCkge1xuXHRcdGlmICh0aGlzLmxhc3RTcGluUmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0dGhpcy53aW5BbW91bnQgPSAwO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmxhc3RTcGluUmVzdWx0LmV2ZXJ5KChzeW1ib2wpID0+IHN5bWJvbCA9PT0gJ0RJQU1PTkQnKSkge1xuXHRcdFx0dGhpcy53aW5BbW91bnQgPSA1MjA7XG5cdFx0XHR0aGlzLmNyZWRpdHMgKz0gdGhpcy53aW5BbW91bnQ7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKG5ldyBTZXQodGhpcy5sYXN0U3BpblJlc3VsdCkuc2l6ZSA9PT0gMSkge1xuXHRcdFx0dGhpcy53aW5BbW91bnQgPSAxMTA7XG5cdFx0XHR0aGlzLmNyZWRpdHMgKz0gdGhpcy53aW5BbW91bnQ7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMubGFzdFNwaW5SZXN1bHQuZmlsdGVyKChzeW1ib2wpID0+IHN5bWJvbCA9PT0gJ0RJQU1PTkQnKS5sZW5ndGggPT09IDIpIHtcblx0XHRcdHRoaXMud2luQW1vdW50ID0gNDU7XG5cdFx0XHR0aGlzLmNyZWRpdHMgKz0gdGhpcy53aW5BbW91bnQ7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0dGhpcy53aW5BbW91bnQgPSAwO1xuXHR9XG5cblx0Z2V0U3RhdGUoKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGNyZWRpdHM6IHRoaXMuY3JlZGl0cyxcblx0XHRcdGxhc3RTcGluUmVzdWx0OiB0aGlzLmxhc3RTcGluUmVzdWx0LnNsaWNlKCksXG5cdFx0XHR3aW5BbW91bnQ6IHRoaXMud2luQW1vdW50LFxuXHRcdFx0c3BpbkNvc3Q6IHRoaXMuc3BpbkNvc3Rcblx0XHR9O1xuXHR9XG5cblx0cmVzZXRTdGF0ZSgpIHtcblx0XHR0aGlzLnJlZWxzID0gdGhpcy5nZW5lcmF0ZVJlZWxzKCk7XG5cdFx0dGhpcy5pc1NwaW5uaW5nID0gZmFsc2U7XG5cdFx0dGhpcy5sYXN0U3BpblJlc3VsdCA9IFtdO1xuXHRcdHRoaXMud2luQW1vdW50ID0gMDtcblx0fVxuXG5cdG5vcm1hbGl6ZU51bWJlcih2YWx1ZSwgZmFsbGJhY2spIHtcblx0XHRpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJyB8fCBOdW1iZXIuaXNOYU4odmFsdWUpIHx8IHZhbHVlIDw9IDApIHtcblx0XHRcdHJldHVybiBmYWxsYmFjaztcblx0XHR9XG5cdFx0cmV0dXJuIE1hdGguZmxvb3IodmFsdWUpO1xuXHR9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRGlhbW9uZHpTbG90O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaO0FBQ0E7QUFDQTtBQUNBO0FBRUEsTUFBTUEsT0FBTyxHQUFHLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUM7QUFFdEUsTUFBTUMsWUFBWSxDQUFDO0VBQ2xCQyxXQUFXQSxDQUFDQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDekIsSUFBSSxDQUFD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